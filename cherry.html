<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<meta http-equiv="X-UA-Compatible" content="ie=edge" />

		<title>Cherry</title>

		<!-- <link rel="stylesheet" href="style.css" /> -->

		<!-- jQuery -->
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>

		<!-- Bootstrap -->
		<link
			href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css"
			rel="stylesheet"
			integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC"
			crossorigin="anonymous"
		/>
		<script
			src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
			integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
			crossorigin="anonymous"
		></script>

		<style>
			.marks > div {
				display: grid;
				grid-template-columns: 4fr 2fr 2fr 1fr;
			}
			#svg {
				width: calc((100vw * 0.75) - 20px);
				height: 100vh;
				border: 1px solid #ddddddbb;
				box-sizing: border-box;
			}
		</style>
	</head>
	<body>
		<div class="container-fluid">
			<div class="row">
				<div class="col-3">
					
					<div class="row gy-3 gx-2 mb-1 align-items-center">
						<div class="col-1"><b>X: </b></div>
						<!-- Text Input -->
						<div class="col-5">
							<input type="number" id="minX" id="minX" class="form-control-sm" />
						</div>
						<div class="col-5">
							<input type="number" id="maxX" id="maxX" class="form-control-sm" />
						</div>
					</div>
					<div class="row gy-3 gx-2 mb-2 align-items-center">
						<div class="col-1"><b>Z: </b></div>
						<!-- Text Input -->
						<div class="col-5">
							<input type="number" id="minZ" id="minZ" class="form-control-sm" />
						</div>
						<div class="col-5">
							<input type="number" id="maxZ" id="maxZ" class="form-control-sm" />
						</div>
					</div>

					<div class="row gy-3 gx-2 align-items-center">

						<!-- Text Input -->
						<div class="col-6">
							<input type="text" id="newValue" class="form-control-sm" />
						</div>

						<!-- Type DropDown -->
						<div class="col-4">
							<select id="markType" class="form-select form-select-sm" aria-label=".form-select-sm mark-type"></select>
						</div>

						<!-- Submit Button -->
						<div class="col-2">
							<button class="btn btn-outline-secondary btn-sm" type="button" id="submit">Add</button>
						</div>
					</div>

					<div id="coords" class="coords">
						<div class="marks">
							<div><b>Type</b><b>X</b><b>Z</b><b>&nbsp;</b></div>
						</div>
						<div id="marks" class="marks"></div>
					</div>
				</div>
				<div class="col-9">
					<svg id="svg" width="calc((100vw * 0.75) - 20px)" height="100vh"><polygon points="50,10 0,190 100,190" fill="lime" /></svg>
				</div>
			</div>
		</div>

		<!-- <script src="index.js"></script> -->
		<script>
			$(document).ready(function () {
				const listInfo = {
					village: "Village",
					ancientCity: "Ancient City",
					pillagerOutpost: "Pillager Outpost",
					portal: "Portal",
					smallRuin: "Small Ruin",
					shipwreck: "Shipwreck",
				};
				var svgWidth = $("#svg").width(),
					svgHeight = $("#svg").height(),
					minX = 0,
					maxX = svgWidth,
					minY = 0,
					maxY = svgHeight;

				// storage
				function _setLocalStorage(value) {
					localStorage.removeItem("cherryList");
					localStorage.setItem("cherryList", JSON.stringify(value));
				}
				function _getLocalStorage() {
					return JSON.parse(localStorage.getItem("cherryList"));
				}

				// helpers
				function createMark(value) {
					const type = $("#markType").val(),
						id = genID(),
						oldList = _getLocalStorage();

					if (value && type && id) {
						const valueSplit = value.split(" ");
						console.log("valueSplit: ", valueSplit);

						const newList = {
							...oldList,
							[id]: {
								id,
								type,
								x: valueSplit[1],
								z: valueSplit[3],
							},
						};

						_setLocalStorage(newList);

						displayMarks();

						$("#newValue").val("");
					}
				}
				function genID() {
					return Math.random()
						.toString(36)
						.substring(2, 12 + 2);
				}

				// display
				function displayMarks(marks = null) {
					if (!marks) marks = _getLocalStorage();

					// clear
					$("#marks").html("");
					$("#svg").html("");

					Object.entries(marks).forEach(function ([key, { id, type, x, z }]) {
						// mark list
						$("#marks").append(
							$("<div id='" + id + "'></div>")
								.append($("<div></div>").text(type))
								.append($("<div></div>").text(x))
								.append($("<div></div>").text(z))
								.append($("<div></div>").append($("<button>X</button>")))
						);

						// svg
						const fC = type === "village" ? "brown" : "red";
						$("#svg").append(rect(10, 10, translateX(x), translateY(z), fC));
					});
				}
				function rect(width, height, x, y, fill) {
					// return `<rect width="${width}" height="${height}" x="${x}" y="${y}" fill="${fill}" />`;
					console.log("width: ", width, " height: ", height, " x: ", x, " y: ", y, " fill: ", fill)
					return $("<rect/>", {
						width,
						height,
						x,
						y,
						fill,
					});
				}
				function translateX(x) {
					return ((x - minX) / (maxX - minX)) * svgWidth;
				}
				function translateY(z) {
					return ((z - minY) / (maxY - minY)) * svgHeight;
				}

				// init storage
				const l = _getLocalStorage();
				if (!l) _setLocalStorage({});
				else displayMarks(l);

				// init options
				Object.entries(listInfo).forEach(function ([val, name]) {
					$("#markType").append($("<option></option>").val(val).text(name));
				});

				// on enter
				$("#newValue").on("keypress", function (e) {
					const v = e.target.value;
					// if enter key
					if (e.which == 13 && v) {
						console.log("v: ", v);
						// addValue(e);
						createMark(v);
					}
				});
				// on submit
				$("#submit").on("click", function (e) {
					const v = $("#newValue").val();
					console.log("v: ", v);
					if (v) createMark(v);
				});
			});
		</script>
	</body>
</html>
