<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<meta http-equiv="X-UA-Compatible" content="ie=edge" />

		<title>Cherry</title>

		<!-- <link rel="stylesheet" href="style.css" /> -->

		<!-- jQuery -->
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>

		<!-- Bootstrap -->
		<link
			href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css"
			rel="stylesheet"
			integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC"
			crossorigin="anonymous"
		/>
		<script
			src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
			integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
			crossorigin="anonymous"
		></script>

		<style>
			#marks > div {
				display: grid;
				grid-template-columns: 2fr repeat(2, 1fr);
			}
			#svg {
				width: 100vh;
				height: calc(100vw * 0.75);
				border: 1px solid #ddddddbb;
				box-sizing: border-box;
			}
		</style>
	</head>
	<body>
		<div class="container-fluid">
			<div class="row">
				<div class="col-3">
					<label for="newValue" class="col-form-label-sm">Add</label>
					<div class="row gy-3 gx-2 align-items-center">
						<!-- Text Input -->
						<div class="col-6">
							<input
								type="text"
								id="newValue"
								class="form-control-sm"
							/>
						</div>

						<!-- Type DropDown -->
						<div class="col-4">
							<select
								id="markType"
								class="form-select form-select-sm"
								aria-label=".form-select-sm mark-type"
							></select>
						</div>

						<!-- Submit Button -->
						<div class="col-2">
							<button
								class="btn btn-outline-secondary btn-sm"
								type="button"
								id="submit"
							>
								Add
							</button>
						</div>
					</div>

					<div id="marks" class="coords"></div>
				</div>
				<div class="col-9">
					<svg id="svg"></svg>
				</div>
			</div>
		</div>

		<!-- <script src="index.js"></script> -->
		<script>
			$(document).ready(function () {
				const listInfo = {
					village: "Village",
					ancientCity: "Ancient City",
					pillagerOutpost: "Pillager Outpost",
					portal: "Portal",
					smallRuin: "Small Ruin",
					shipwreck: "Shipwreck",
				};
				// storage
				function _setLocalStorage(value) {
					localStorage.setItem("cherryList", JSON.stringify(value));
				}
				function _getLocalStorage() {
					return JSON.parse(localStorage.getItem("cherryList"));
				}

				// helpers
				function createMark(value) {
					const type = $("#markType").val(),
						id = genID();

					const valueSplit = value.split(" ");
					console.log("valueSplit: ", valueSplit);
					newList = {
						..._getLocalStorage(),
						[id]: {
							id,
							type,
							x: valueSplit[1],
							z: valueSplit[3],
						},
					};

					_setLocalStorage(newList);

					displayMarks();
				}
				function genID() {
					return Math.random()
						.toString(36)
						.substring(2, 12 + 2);
				}
				// display
				function displayMarks(l = null) {
					if (!l) l = _getLocalStorage();

					Object.entries(l).forEach(function ([
						key,
						{ id, type, x, z },
					]) {
						$("#marks").append(
							$("<div id='" + id + "'></div>")
								.append($("<div></div>").text(type))
								.append($("<div></div>").text(x))
								.append($("<div></div>").text(z))
						);
					});
				}

				// init storage
				const l = _getLocalStorage();
				if (!l) _setLocalStorage({});
				else displayMarks(l);

				// init options
				Object.entries(listInfo).forEach(function ([val, name]) {
					$("#markType").append(
						$("<option></option>").val(val).text(name)
					);
				});

				// on enter
				$("#newValue").on("keypress", function (e) {
					// if enter key
					if (e.which == 13) {
						const v = e.target.value;
						console.log("v: ", v);
						// addValue(e);
						createMark(v);
					}
				});
				// on submit
				$("#submit").on("click", function (e) {
					const v = $("#newValue").val();
					console.log("v: ", v);
					createMark(v);
				});
			});
		</script>
	</body>
</html>
